server {
    listen 9097;
    server_name _;

    # Common proxy settings
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # Allow all methods for /pins exactly
    location = /pins {
        proxy_pass http://cluster:9098;
    }

    # Restrict methods for /pins/{requestid}
    location ~ ^/pins/[^/]+$ {
        limit_except GET {
            deny all;
        }
        proxy_pass http://cluster:9098;
    }

    # Default location for all other paths
    location / {
        proxy_pass http://cluster:9098;
    }
} 